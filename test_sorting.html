<!DOCTYPE html>
<html>
<head>
    <title>Test Sorting Functionality</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .sortable { cursor: pointer; background: #f0f0f0; padding: 10px; margin: 5px; border: 1px solid #ccc; }
        .sortable:hover { background: #e0e0e0; }
        .sortable.asc::after { content: ' ↑'; color: blue; }
        .sortable.desc::after { content: ' ↓'; color: blue; }
    </style>
</head>
<body>
    <h1>Sorting Test</h1>
    <p>Click the buttons below to test sorting:</p>
    
    <div class="sortable" data-column="node_id">Sort by Node ID</div>
    <div class="sortable" data-column="name">Sort by Name</div>
    <div class="sortable" data-column="battery_level">Sort by Battery</div>
    
    <div id="result"></div>

    <script>
        // Test data
        let testNodes = [
            {node_id: "!aaa123", short_name: "Node A", battery_level: 85, role: "CLIENT"},
            {node_id: "!zzz789", short_name: "Node Z", battery_level: 45, role: "ROUTER"},
            {node_id: "!mmm456", short_name: "Node M", battery_level: 90, role: "CLIENT_MUTE"}
        ];
        
        let currentSortColumn = null;
        let currentSortDirection = 'asc';
        
        function getSortValue(node, column) {
            switch (column) {
                case 'node_id': return node.node_id;
                case 'name': return node.short_name;
                case 'battery_level': return node.battery_level || -1;
                default: return '';
            }
        }
        
        function sortNodes(column) {
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }
            
            // Update visual indicators
            document.querySelectorAll('.sortable').forEach(th => {
                th.classList.remove('asc', 'desc');
            });
            const activeHeader = document.querySelector(`.sortable[data-column="${column}"]`);
            if (activeHeader) {
                activeHeader.classList.add(currentSortDirection);
            }
            
            // Sort the array
            testNodes.sort((a, b) => {
                let valueA = getSortValue(a, column);
                let valueB = getSortValue(b, column);
                
                if (valueA === null || valueA === undefined) valueA = '';
                if (valueB === null || valueB === undefined) valueB = '';
                
                if (typeof valueA === 'string') valueA = valueA.toLowerCase();
                if (typeof valueB === 'string') valueB = valueB.toLowerCase();
                
                let comparison = 0;
                if (valueA < valueB) comparison = -1;
                else if (valueA > valueB) comparison = 1;
                
                return currentSortDirection === 'desc' ? -comparison : comparison;
            });
            
            // Display result
            document.getElementById('result').innerHTML = `
                <h3>Sorted by ${column} (${currentSortDirection}):</h3>
                <pre>${JSON.stringify(testNodes, null, 2)}</pre>
            `;
        }
        
        // Setup event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.sortable').forEach(button => {
                button.addEventListener('click', function() {
                    const column = this.getAttribute('data-column');
                    console.log('Clicked column:', column);
                    sortNodes(column);
                });
            });
            
            // Initial display
            document.getElementById('result').innerHTML = `
                <h3>Initial data:</h3>
                <pre>${JSON.stringify(testNodes, null, 2)}</pre>
            `;
        });
    </script>
</body>
</html>